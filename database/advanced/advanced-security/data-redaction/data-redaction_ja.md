# Oracleデータ・リダクション

## 概要

このワークショップでは、Oracle Data Redactionの様々な機能について説明します。ユーザーは、これらの機能をオンザフライでリダクションすることで機密データへのアクセスを保護するために構成する方法を学ぶことができます。

_推定ラボ時間:_ 15分

_この演習でテストしたバージョン:_ Oracle DB 19.19

### ビデオ・プレビュー

「_Livelabs - Oracle ASO (Transparent Data Encryption & Data Redaction) (2022年5月)_」のプレビューを見る[](youtube:JflshZKgxYs)

### 目標

機密データを動的にリダクションして、アプリケーションの外部に表示しないようにします。

### 前提条件

この演習では、次を想定しています。

*   Free Tier、有料またはLiveLabs Oracle Cloudアカウント
*   次を完了しました:
    *   演習: 設定の準備(_無料層_および_有料テナント_のみ)
    *   演習: 環境設定
    *   演習: 環境の初期化

### ラボのタイミング(推定)

| ステップ番号 | 機能 | 近似時間 |
| --- | --- | --- |
| 1 | 基本的なデータ・リダクション・ポリシーの作成 | 5分 |
| 2 | 既存のデータ・リダクション・ポリシーのコンテキスト化 | 5分 |
| 3 | データ・リダクション・ポリシーの削除 | 5分未満 |

## タスク1: 基本的なデータ・リダクション・ポリシーの作成

1.  OSユーザー**oracle**として、_DBSec-Lab_ VMでターミナル・セッションを開きます
    
        <copy>sudo su - oracle</copy>
        
    
    **ノート**: リモート・デスクトップ・セッションを使用している場合は、デスクトップの_ターミナル_・アイコンをダブルクリックしてセッションを起動します。
    
2.  scriptsディレクトリへ移動します
    
        <copy>cd $DBSEC_LABS/data-redaction</copy>
        
3.  まず、リダクションする前にデータを表示します。
    
    *   **SQL\*Plus**で、この問合せを実行して元のデータを確認してください
        
            <copy>./dr_query_employee_data.sh</copy>
            
        
        ![データ・リダクション](./images/dr-001.png "元のデータを見る")
        
        **ノート**: 従業員によっては、SIN、SSNまたはNINO番号があります。
        
    *   次に、**Glassfishアプリケーション**を見てみましょう
        
        *   URL _`http://dbsec-lab:8080/hr_prod_pdb1`_でWebブラウザを開く
            
            **ノート:**リモート・デスクトップを使用していない場合は、_`http://<YOUR_DBSEC-LAB_VM_PUBLIC_IP>:8080/hr_prod_pdb1`_に移動してこのページにアクセスすることもできます
            
        *   _`hradmin`_として、パスワード_`Oracle123`_でHRアプリケーションにログインします。
            
                <copy>hradmin</copy>
                
            
                <copy>Oracle123</copy>
                
            
            ![データ・リダクション](./images/dr-002.png "HRアプリケーション- ログイン") ![データ・リダクション](./images/dr-003.png "HRアプリケーション- ログイン")
            
        *   **「従業員の検索」**をクリックします。
            
            ![データ・リダクション](./images/dr-004.png "HRアプリケーション- 従業員の検索")
            
        *   たとえば、_`77`_を**HR ID**値として入力し、\[**検索**\]をクリックして、従業員"Alice - UserID 77"をフィルタします
            
            ![データ・リダクション](./images/dr-005.png "HRアプリケーション- 従業員の検索(UserID 77)")
            
        *   ここで、この従業員の**「氏名」**リンクをクリックして、彼女の詳細を表示します
            
            ![データ・リダクション](./images/dr-006.png "HRアプリケーション- 氏名")
            
        *   ご覧のとおり、Glassfishでも列SINのデータも完全にリダクションされます
            
            ![データ・リダクション](./images/dr-007.png "HRアプリケーション- SIN値")
            
4.  ターミナル・セッションに戻り、リダクション・ポリシー`PROTECT_EMPLOYEES`を作成します
    
        <copy>./dr_redact_for_all.sh</copy>
        
    
    ![データ・リダクション](./images/dr-008.png "リダクション・ポリシーPROTECT_EMPLOYEESを作成します")
    
    **ノート**: このポリシーでは、(**FULL**)すべてのコンテキストのすべての問合せについて、列**SIN**のデータを`DEMO_HR_EMPLOYEES`表からリダクションします(**式"1=1"**)。
    
5.  ここで、問合せを再実行して、リダクションされたデータを確認し、データ・リダクション・ポリシーの作成後にSIN列に何が起こったかを確認します
    
        <copy>./dr_query_employee_data.sh</copy>
        
    
    ![データ・リダクション](./images/dr-009.png "リダクションされたデータを見る")
    
    **ノート:**
    
    *   ご覧のとおり、列SINからのデータは完全にリダクションされています。
    *   有効にすると、データ・リダクション・ポリシーがただちに適用され、何も再起動する必要はありません。
    *   データ・リダクションはすでにOracleコア製品に組み込まれているため、構成するものはありません。問合せを再実行して、機密データに対して作成されたデータ・リダクション・ポリシーの影響を確認してください
    *   データベース側で操作するだけで、それは...アプリケーション側で何かをリコードする必要はありません。
6.  次に、Glassfishアプリケーションに戻り、Webページをリフレッシュします(**\[F5\]を押す**)。
    
    ![データ・リダクション](./images/dr-010.png "HRアプリケーション- SIN値")
    
    **ノート:**
    
    *   さて、Glassfishでさえ、列SINも完全にリダクションされています!
    *   すべてのコンテキスト(**式"1=1"**)のすべての問合せについて、リダクション・ポリシーが列**SIN**で作成されているため、これは正常です
    *   再度有効にすると、データ・リダクション・ポリシーがただちに適用され、何も再起動する必要はありません。

## タスク2: 既存のデータ・リダクション・ポリシーのコンテキスト化

1.  ここで、リダクション・ポリシーを非Glassfish問合せのみをリダクションするように変更します(そのためには、**「ルール・セット」を使用した式**が必要です)。
    
        <copy>./dr_redact_nonapp_queries.sh</copy>
        
    
    ![データ・リダクション](./images/dr-011.png "非Glassfish問合せのみをリダクション")
    
    **ノート**: 現在、同じポリシー(**FULL**)によって、`DEMO_HR_EMPLOYEES`表から列**SIN**のデータがリダクションされますが、コンテキストが認可されていない問合せに対してのみリダクションされます。
    
2.  既存のデータ・リダクション・ポリシーに新しい列を追加する簡単な方法を示すには、リダクション・ポリシーに列(**SSN**および**NINO**)を追加します。
    
        <copy>./dr_add_redacted_columns.sh</copy>
        
    
    ![データ・リダクション](./images/dr-012.png "リダクション・ポリシーの変更")
    
    **ノート**: 同じように、このデータ・リダクション・ポリシーは、同じコンテキストの列SSNおよびNINOにも適用されます
    
3.  では、その影響について見ていきましょう。
    
    *   ...**SQL\*Plus** (現在から認可されていないアプリケーション)
        
            <copy>./dr_query_employee_data.sh</copy>
            
        
        ![データ・リダクション](./images/dr-013.png "SQLPlusのデータを参照")
        
        **ノート**: 機密データは表示されません。
        
    *   ... Webページをリフレッシュするだけで**Glassfishアプリケーション**(今から唯一の認可アプリケーション)に**\[F5\]を押す**
        
        ![データ・リダクション](./images/dr-007.png "HRアプリのデータを見る")
        
        **ノート**: 唯一の承認済アプリケーションを使用しているため、機密データを今すぐ確認できます。
        

## タスク3: データ・リダクション・ポリシーの削除

1.  演習が終了したら、リダクション・ポリシーを削除できます。
    
        <copy>./dr_drop_redaction_policy.sh</copy>
        
    
    ![データ・リダクション](./images/dr-014.png "リダクション・ポリシーの削除")
    
2.  すべてのデータがリダクションされていないことを確認します。
    
        <copy>./dr_query_employee_data.sh</copy>
        
    
    ![データ・リダクション](./images/dr-001.png "データの確認")
    

次の演習に進むことができます。

## **付録**: 製品について

### **概要**

Oracle Databaseコア製品内でハードコードされているこの機能は、_拡張セキュリティ・オプション(ASO)_の一部です。

データ・リダクションを使用すると、アプリケーションが発行する問合せから返されるデータをマスク(リダクション)できます。動的データ・マスキングについても説明します。

次の方法のいずれかを使用して、列データをリダクションできます。

*   **完全リダクション**列データのすべてのコンテンツをリダクションします。問合せ元ユーザーに返されるリダクション済の値は、列のデータ型によって異なります。たとえば、NUMBERデータ型の列はゼロ(0)でリダクションされ、文字データ型は空白でリダクションされます。
    
*   **部分的なリダクション**列データの一部をリダクションします。たとえば、最後の4桁を除き、社会保障番号の大部分をアスタリスク(\*)でリダクションできます。
    
*   **正規表現**正規表現は、完全リダクションと部分リダクションの両方で使用できます。これにより、データの検索パターンに基づいてデータをリダクションできます。たとえば、正規表現を使用して、データ内の特定の電話番号または電子メール・アドレスをリダクションできます。
    
*   **ランダム・リダクション**問い合せを行ったユーザーに示されるリダクション済のデータは、列のデータ型に応じて、表示されるたびにランダムに生成された値として表示されます。
    
*   **リダクションなし**このオプションを使用すると、ポリシーが定義された表に対する問合せの結果に影響を与えることなく、リダクション・ポリシーの内部操作をテストできます。本番環境に適用する前に、このオプションを使用してリダクション・ポリシー定義をテストできます。
    

データ・リダクションは、実行時にリダクションを実行します。つまり、ユーザーがデータを表示しようとする瞬間です。この機能は、データが絶えず変化する動的な本番システムに最適です。データがリダクションされている間、Oracle Databaseはすべてのデータを正常に処理し、バックエンドの参照整合性制約を保持できます。データ・リダクションは、Payment Card Industry Data Security Standard(PCI DSS)やSarbanes-Oxley Actなどの業界の規制に準拠するのに役立ちます。

![データ・リダクション](./images/aso-concept-dr.png "データ・リダクションの概念")

### **Oracle Data Redactionを使用する利点**

*   異なるスタイルのリダクションから選択
*   データは実行時にリダクションされるため、データ・リダクションは、データが常時変更されている環境に適しています。
*   中央の1か所にリダクション・ポリシーを作成して、そこから簡単に管理できます。
*   データ・リダクション・ポリシーを使用して、データ・リダクション・ポリシーがアプリケーション・ユーザーの問合せの結果に適用されるタイミングを決定するために実行時に使用できる`SYS_CONTEXT`値に基づいて、様々な種類の関数の条件を作成できます

## 詳細

技術文書:

*   [データ・リダクション19c](https://docs.oracle.com/en/database/oracle/oracle-database/19/asoag/asopart1.html)

ビデオ:

*   _Oracle Data Redactionの理解(2020年7月)_[](youtube:ssy6Hov-MAs)

## 謝辞

*   **著者** - Database Security PM、Hakim Loumi氏
*   **貢献者** - Rene Fontcha
*   **最終更新者/日付** - Hakim Loumi、データベース・セキュリティPM - 2023年11月