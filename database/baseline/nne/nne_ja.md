# Oracleネイティブ・ネットワーク暗号化(NNE)

## 概要

このワークショップでは、Oracle Native Network Encryption (NNE)の機能を紹介します。これにより、移動中のデータを暗号化および保護するためにこの機能を構成する方法を学習できます。

_推定ラボ時間:_ 15分

_この演習でテストしたバージョン:_ Oracle DB 19.19

### ビデオ・プレビュー

「_LiveLabs - Oracle Native Network Encryption (May 2022)_」のプレビューを見る[](youtube:N6Uz-pVTkaI)

### 目標

*   データベースでのネイティブ・ネットワーク暗号化の有効化/無効化
*   有効にする前後のネットワーク暗号化の影響を確認する

### 前提条件

この演習では、次を想定しています。

*   Free Tier、有料またはLiveLabs Oracle Cloudアカウント
*   次を完了しました:
    *   演習: 設定の準備(_無料層_および_有料テナント_のみ)
    *   演習: 環境設定
    *   演習: 環境の初期化

### ラボのタイミング(推定)

| ステップ番号 | 機能 | 近似時間 |
| --- | --- | --- |
| 1 | 現在のネットワーク構成の確認 | 5分未満 |
| 2 | SQLトラフィックの生成および取得 | 5分 |
| 3 | ネットワーク暗号化の有効化 | 5分 |
| 4 | ネットワーク暗号化の無効化 | 5分未満 |

## タスク1: 現在のネットワーク構成の確認

1.  OSユーザー**oracle**として、_DBSec-Lab_ VMでターミナル・セッションを開きます
    
        <copy>sudo su - oracle</copy>
        
    
    **ノート**: リモート・デスクトップ・セッションを使用している場合は、デスクトップの_ターミナル_・アイコンをダブルクリックしてセッションを起動します。
    
2.  scriptsディレクトリへ移動します
    
        <copy>cd $DBSEC_LABS/nne</copy>
        
3.  **SQL\*Net.ora**ファイルの内容の表示
    
        <copy>./nne_view_sqlnet_ora.sh</copy>
        
    
    **ノート**: 空である必要があります。
    
    ![ネットワーク暗号化](./images/nne-001.png "SQLNetファイルの内容の表示")
    
4.  ネットワークがすでに暗号化されているかどうかを確認します
    
        <copy>./nne_is_sess_encrypt.sh</copy>
        
    
    ![ネットワーク暗号化](./images/nne-002.png "ネットワークがすでに暗号化されているかどうかを確認します")
    
    **ノート**: 「暗号化サービス・アダプタ」行が表示されません
    

## タスク2: SQLトラフィックの生成および取得

1.  トラフィックに対して **tcpdump**を実行して、ネットワーク上で転送中のパケットを分析します(実行の終了を待機します)
    
        <copy>./nne_tcpdump_traffic.sh</copy>
        
    
    ![ネットワーク暗号化](./images/nne-003a.png "トラフィックのtcpdump")
    
    ![ネットワーク暗号化](./images/nne-003b.png "トラフィックのtcpdump")
    
    **ノート:**
    
    *   `DEMO_HR_EMPLOYEES`表に対して問合せを実行します。
    *   出力は **`tcpdump.pcap`**ファイルに保存されました
    *   pcapファイルの分析に使用できるツールはたくさんあります
2.  ここで、生成されたtcpdump.pcapファイルから機密データを抽出して、釣りが良かったかどうかを確認します
    
        <copy>./nne_tcpdump_extract.sh</copy>
        
    
    ![ネットワーク暗号化](./images/nne-004.png "tcpdumpファイルから機密データを抽出")
    
    **ノート:**
    
    *   電子メールなどを含むすべての行を抽出します
    *   ネットワークはクリア・テキストであるため、`DEMO_HR_EMPLOYEES`表データは完全に読取り可能です。
3.  次に、**tcpflow**を実行して、Glassfishアプリケーションのワイヤ間のトラフィックを取得します
    
    *   取得スクリプトを開始し、**終了しないでください。**
        
            <copy>./nne_tcpflow_traffic.sh</copy>
            
        
        ![ネットワーク暗号化](./images/nne-005.png "取得スクリプトの開始")
        
        **ノート:**電子メールなどを含むすべての行を抽出します(egrepコマンドを参照)。
        
    *   並行して、_`http://dbsec-lab:8080/hr_prod_pdb1`_へのWebブラウザ・ウィンドウを開き、Glassfishアプリケーションにアクセスします
        
        **ノート:**リモート・デスクトップを使用していない場合は、_`http://<YOUR_DBSEC-LAB_VM_PUBLIC_IP>:8080/hr_prod_pdb1`_に移動してこのページにアクセスすることもできます
        
    *   次のステップを実行します。
        
        *   _`hradmin`_として、パスワード_`Oracle123`_でHRアプリケーションにログインします。
            
                <copy>hradmin</copy>
                
            
                <copy>Oracle123</copy>
                
            
            ![ネットワーク暗号化](./images/nne-006.png "HRアプリケーションへのログイン") ![ネットワーク暗号化](./images/nne-007.png "HRアプリケーションへのログイン")
            
        *   **「従業員の検索」**をクリックします。
            
            ![ネットワーク暗号化](./images/nne-008.png "従業員の検索")
            
        *   \[**検索**\]をクリックします
            
            ![ネットワーク暗号化](./images/nne-009.png "従業員の検索")
            
    *   ターミナル・セッションに戻り、トラフィック・コンテンツを確認します
        
        ![ネットワーク暗号化](./images/nne-010.png "トラフィック・コンテンツの表示")
        
4.  暗号化されていないデータを確認したら、「_`[Ctrl]+C`_」を使用してスクリプトを停止します。
    
    **ノート:**ネットワークはクリア・テキストであるため、転送中のすべての機密データにアクセスできます。
    

## タスク3: ネットワーク暗号化の有効化

_`SQLNET.ENCRYPTION_SERVER`_の_`REQUESTED`_値を使用してSQL\*Net暗号化を有効にします

1.  まず、暗号化されていない接続が引き続き接続できるようにするため、このオプションを使用します。これはほとんど影響を与えませんが、変更によってクライアントとデータベースの間で暗号化できない本番システムが妨げられないようにすることが重要になることがよくあります。
    
        <copy>./nne_enable_requested.sh</copy>
        
    
    ![ネットワーク暗号化](./images/nne-011.png "ネットワーク暗号化の有効化")
    
    **ノート**: ネイティブ・ネットワーク暗号化の代替手段があり、TLS証明書ですが、ユーザー管理とその他の構成が必要です
    
2.  スクリプトを再実行して、セッションが暗号化されているかどうかを確認します。
    
        <copy>./nne_is_sess_encrypt.sh</copy>
        
    
    ![ネットワーク暗号化](./images/nne-012.png "セッションが暗号化されているかどうかを確認します")
    
    **ノート**: 「**AES256 Encryption service adapter for Linux**」という追加の行が表示されます。
    
3.  ここで、トラフィックで **tcpdump**を再実行して、ネットワーク上の転送中のパケットを分析します(実行の終了を待機します)
    
        <copy>./nne_tcpdump_traffic.sh</copy>
        
    
    ![ネットワーク暗号化](./images/nne-003a.png "トラフィックのtcpdump")
    
    ![ネットワーク暗号化](./images/nne-003b.png "トラフィックのtcpdump")
    
4.  前述のように、生成された新しいtcpdump.pcapファイルから同じ機密データを抽出します。
    
        <copy>./nne_tcpdump_extract.sh</copy>
        
    
    ![ネットワーク暗号化](./images/nne-013.png "新しいtcpdumpファイルから機密データを抽出します")
    
    **ノート:**
    
    *   電子メールなどを含むすべての行を抽出します
    *   セッションは暗号化されているため、`DEMO_HR_EMPLOYEES`表データは読み取れません。
5.  次に、**tcpflow**でGlassfishアプリケーションのテストを実行して、ネットワーク暗号化の影響を確認します。
    
    *   ターミナル・セッションで、生成されたトラフィックを取得し、再度**クローズしないでください。**
        
            <copy>./nne_tcpflow_traffic.sh</copy>
            
        
        ![ネットワーク暗号化](./images/nne-005.png "tcpflowを使用して、生成されたトラフィックを取得します。")
        
    *   Webブラウザに戻り、Glassfishアプリケーションを**ログアウト**し、**`hradmin`**として再度_ログイン_して、このトラフィックをスニフしたときに何が起こるかを確認します
        
        ![ネットワーク暗号化](./images/nne-006.png "Glassfishアプリケーション")
        
        ![ネットワーク暗号化](./images/nne-007.png "Glassfishアプリケーション")
        
    *   **「従業員の検索」**をクリックします。
        
        ![ネットワーク暗号化](./images/nne-008.png "従業員の検索")
        
    *   \[**検索**\]をクリックします
        
        ![ネットワーク暗号化](./images/nne-009.png "従業員の検索")
        
    *   ターミナル・セッションに戻り、トラフィック・コンテンツを確認します
        
        ![ネットワーク暗号化](./images/nne-005.png "トラフィック・コンテンツの表示")
        
    
    **ノート:**
    
    *   データは表示されません。
    *   電子メールなどを含むすべての行を抽出しようとしていますが、ネットワークが暗号化されているため、何もありません。
    *   データはGlassfishアプリケーション(JDBC Thinクライアント)とデータベース間で暗号化されます。
    *   Glassfishアプリケーションが問合せごとに新しい接続を作成するため、これはただちに(またはリフレッシュ後に)機能します。
    *   既存のアプリケーション接続をデータベースから切断するには、実際のアプリケーションを停止して再起動する必要がある可能性があります。
6.  ネットワーク暗号化の影響を確認したら、「_`[Ctrl]+C`_」を使用してスクリプトを停止します。
    

## タスク4: ネットワーク暗号化の無効化

1.  演習を完了すると、ネイティブ・ネットワーク暗号化をデフォルト設定に戻すことができます。
    
        <copy>./nne_disable.sh</copy>
        
    
    ![ネットワーク暗号化](./images/nne-014.png "ネットワーク暗号化の無効化")
    

次の演習に進むことができます。

## **付録**: 製品について

### **概要**

Oracle Databaseは、ネットワーク間を移動するデータが保護されるように、ネイティブの**データ・ネットワークの暗号化および整合性**を提供します。

![ネットワーク暗号化](./images/nne-concept.png "ネットワーク暗号化の概念")

安全な暗号システムの目的は、キーに基づいてプレーンテキストデータを理解不能な暗号文に変換することです。正しいキーを知らずに、暗号文を対応するプレーンテキストに変換することは非常に困難(計算上は不可能)です。

対称暗号システムでは、同じデータの暗号化と復号化の両方に同じキーが使用されます。Oracle Net Servicesトラフィックの機密保護のために、Oracle Databaseは**Advanced Encryption Standard (AES)の対称暗号システム**を提供しています。

Oracle SQL\*Netトラフィックは、次を使用して暗号化できます。

*   ネイティブ・ネットワーク暗号化
*   TLS証明書ベースの暗号化

## 詳細

技術文書:

*   [Oracleネイティブ・ネットワーク暗号化19c](https://docs.oracle.com/en/database/oracle/oracle-database/19/dbseg/configuring-network-data-encryption-and-integrity.html)

## 謝辞

*   **著者** - Database Security PM、Hakim Loumi氏
*   **貢献者** - Richard Evans
*   **最終更新者/日付** - Hakim Loumi、データベース・セキュリティPM - 2023年11月