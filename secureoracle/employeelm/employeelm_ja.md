# 従業員ライフサイクル管理

## 概要

この演習では、Oracle Identity Managerで**「自分のHRアプリケーション」**を認可ソースとして使用して、従業員のオンボーディング、ユーザー・ライフサイクル、異動、マネージャ承認および従業員の退職に関連するいくつかのユースケースを実行します。

My HR Applicationは、Oracle APEXで開発され、Oracleデータベースでホストされているサンプル・アプリケーションです。その主な機能は、データベースHRスキーマ内の表に従業員データを管理および格納することです。Oracle Identity Managerの**DBATコネクタ**は、Oracle Identity Managerへの従業員レコードのオンボーディングおよび管理を容易にするデータベース表とのインタフェースに使用されます。

![自分のHRアプリケーション](./images/img-myhr-app-menu.png " ")

図1.自分のHRアプリケーション

次のユースケースを使用できます。

*   従業員のオンボードと通知
*   従業員の異動とロールの更新
*   セルフサービス、アクセス・リクエスト、処理可能な通知および承認
*   従業員退職

_推定ラボ時間_: 60分

### 目標

*   従業員のライフサイクル管理の理解

### 前提条件

この演習では、次を想定しています。

*   Free Tier、有料またはLiveLabs Oracle Cloudアカウント
*   次を完了しました:
    *   演習: 設定の準備(_無料層_および_有料テナント_のみ)
    *   演習: 環境設定
    *   演習: 環境の初期化

## タスク1: 必要なコンポーネントおよびアプリケーションへのアクセスの検証

1.  必要なコンポーネントおよびアプリケーションへのアクセスを検証します。詳細は、_ラボ1: 環境の初期化_を参照してください
    
    Oracle Identity Manager管理コンソール:
    
        URL         http://secureoracle.oracledemo.com:14000/sysadmin
        User        xelsysadm
        Password    Oracle123
        
    
    Oracle Identity Managerセルフサービス:
    
        URL         http://secureoracle.oracledemo.com:14000/identity
        User        xelsysadm
        Password    Oracle123
        
    
    電子メールWebクライアント(Roundcube):
    
        URL         http://secureoracle.oracledemo.com/roundcubemail-1.4.1/
        User        admin
        Password    Oracle123
        Server      secureoracle.oracledemo.com
        
    
    Email Server管理コンソール(Hedwig Mail Server):
    
        URL         http://secureoracle.oracledemo.com:7001/hedwig-web-0.6/
        User        admin
        Password    Oracle123
        
    
    APEX HRワークスペース
    
        URL         http://secureoracle.oracledemo.com:7001/ords/
        Workspace   HRSPACE
        User        hradmin
        Pass        Oracle123
        
    
    自分のHRアプリケーション:
    
        URL         http://secureoracle.oracledemo.com:7001/ords/f?p=100
        User        hradmin
        Password    Oracle123
        

## タスク2: 従業員のオンボーディングおよび通知

1.  ブラウザでAPEXワークスペース**HRSPACE**を開き、新規従業員を自分のHRアプリケーションにインポートします。
    
    例次のリンクおよび資格証明を使用します。
    
        URL          http://secureoracle.oracledemo.com:7001/ords/
        Workspace    hrspace
        User         hradmin
        Password     Oracle123
        
2.  APEXワークスペースで、**「SQLワークショップ」**タイルをクリックし、**`Utilities -> Data Workshop`**をクリックします。「データ・ワークショップ」ページで、**「データのロード」**をクリックし、**「ファイルの選択」**を選択して、ファイル**`import-new-employees.csv`**の場所を入力します。
    
    **ノート**: ファイル**`import-new-employees.csv`**は、**`/home/oracle/demo/sample-data`からコピーできます**
    
3.  ファイルを分析すると、**「プレビュー」**セクションが表示され、**「プレビュー」**ボタンをクリックすると、インポートされるすべての列および行の完全なビューが表示されます。続行してウィンドウを閉じます。
    
4.  データのロード ページに戻り、必要な情報を入力します。
    
    例次のデータを選択または入力します。
    
        Load To        Existing Table
        Table Owner    HR
        Table Name     EMPLOYEES
        Update Method  Append
        
5.  **「データのロード」**ボタンをクリックして、インポート・プロセスを開始します。新規行のインポートに成功したら、「データのロード」ページを閉じます。
    
6.  APEXワークスペースからサインアウトするには、右上隅にある**HRADMIN**アバターをクリックし、**「サインアウト」**を選択します。
    
7.  別のタブを開き、ユーザー**hradmin**としてログインし、パスワード**Oracle123**を使用して自分のHRアプリケーションにログインします。
    
    たとえば、次のリンクと資格証明を使用します。
    
        URL         http://secureoracle.oracledemo.com:7001/ords/f?p=100
        User        hradmin
        Password    Oracle123
        
8.  **「従業員」**タイルをクリックして従業員ページを開き、次の表の従業員が追加されていることを確認します。
    
    たとえば、前のインポート・プロセスの完了後に次の新規従業員を追加する必要があります。
    
        FULL NAME     USER ID   EMAIL                    DEARTMENT  TITLE       HIRE DATE    END DATE     MANAGER
        Denny Coby    DCOBY     dcoby@oracledemo.com     Sales      Sales Rep   26-Sep-2018               MGRAFF
        Gene Marton   GMARTON   gmarton@oracledemo.com   Finance    Accountant  26-Sep-2018               JSMITH
        Ray Lauria    RLAURIA   rlauria@oracledemo.com   Finance    Accountant  24-Sep-2018               JSMITH
        Robin Mainor  RMAINOR   rmainor@oracledemo.com   Finance    Accountant  03-Sep-2018  28-Sep-2019  JSMITH    
        
    
    **ノート:**前述の従業員のEメール・アカウントはすでに作成されているため、Eメール・アカウントを作成する必要はありません。指示がないかぎり、既存の従業員を削除しないでください。削除すると、デモンストレーション環境で他のユースケースの一部である既存のOIMユーザーが終了するためです。
    
9.  オプションで、**「作成」**ボタンをクリックして新しい従業員を手動で作成できます。ただし、**財務**部門または**営業**部門に属する従業員のみがOIMのリコンシリエーション・タスクを介して正常にインポートされる必要があることに注意してください。
    
    たとえば、新しい従業員を作成するには、少なくとも次のデータを指定する必要があります。
    
        FIRST NAME, LAST NAME, USER NAME, STATUS, EMAIL, JOB, HIRE DATE, DEPARTMENT
        
    
    **ノート:**新しい従業員を追加する前に、OIMへのオンボーディング後に新しい従業員が通知を受信するように、まず電子メール・アカウントを作成する必要があります。管理ユーザーとして**電子メール・サーバー管理コンソール**にアクセスして、新しい電子メール・アカウントを作成します。
    

## タスク3: 新規従業員のオンボード

1.  パスワード**Oracle123**でユーザー**xelsysadm**として[OIM管理コンソール](http://secureoracle.oracledemo.com:14000/sysadmin)にログインします。**「スケジューラ」**オプションをクリックし、「システム管理」タブに移動して検索ボックスに**HRData**と入力するか、矢印アイコンをクリックしてデータをフェッチします。
    
2.  結果リストから、ジョブ**HRData DBAT Trusted Resource User Reconciliation**をダブルクリックします ![OIM管理コンソール・スケジューラ検索結果](./images/hrdata.png " ")
    
3.  「ジョブの詳細」タブで、**「今すぐ実行」**をクリックし、**「リフレッシュ」**をクリックして、「ジョブ履歴」の下にある下部を確認することで進捗をモニターします。
    
4.  ジョブがジョブ・ステータス**Stopped::Success**で完了すると、 ![HRData DBAT信頼できるリソースのユーザー・リコンシリエーション・サービスの詳細](./images/stopped.png " ")
    
5.  上部にある「イベント管理」タブをクリックし、**矢印**アイコンをクリックしてリコンシリエーション・イベントを検索します。プロファイル名が**HRData**のイベントのリストは、レコードが処理されたことを示す最新のイベントとしてリストする必要があります。イベントIDのいずれかをクリックして詳細を表示します。すべてのイベントについて現在のステータスが**「作成に成功しました」**と表示されている場合、インポートは成功しました。管理コンソールからサインアウトします。 ![「イベント管理」タブ](./images/creation.png " ")
    
    **ノート**: リコンシリエーション・ジョブは、OIMに存在しない新しい従業員をインポートします。オプションで、「ジョブの詳細」ページの**「パラメータ」**セクションの下の**「フィルタ」**フィールドにフィルタ式を入力して、フィルタされたリコンシリエーションを実行できます。
    
    たとえば、**「会計担当」**というタイトルの従業員を返す有効なDBATコネクタ・フィルタ式を次に示します。
    
        contains('JOB_TITLE','Accountant')
        
    
    employees表の次の列をフィルタ式で使用できます。
    
        USERNAME, DEPARTMENT_NAME, FIRST_NAME, LAST_NAME, JOB_TITLE, PHONE_NUMBER, MANAGER, EMAIL, HIRE_DATE, END_DATE.
        

## タスク4: オンボーディング従業員の確認

1.  [OIMセルフ・サービス・コンソール](http://secureoracle.oracledemo.com:14000/identity)に、**xelsysadm**というユーザーとしてログインします。パスワードは**Oracle123**です。**`Manage -> Users`**をクリックして、オンボーディングされた従業員が「ユーザー」ページにユーザーとしてリストされているかどうかを確認します。
    
    ![OIMセルフ・サービス・コンソール](./images/oim_users.png " ")
    
2.  「ユーザー」ページにユーザー・ログイン**「RMAINOR」**がリストされている場合は、ユーザー・ログインをクリックして「ユーザー詳細」ページを開き、**「属性」**タブを選択して、このユーザーの**「終了日」**属性を確認します。終了日が現在の日付を過ぎているため、このユーザーは次回の**`Disable/Delete User After End Date`**ジョブ実行で無効化および削除されます。次のステップに進むには、「ユーザー詳細」ページを閉じないでください。
    
3.  ブラウザで別のタブを開き、OIM管理コンソールにログインします。
    
4.  **「スケジューラ」**をクリックし、**「システム管理」**タブでジョブ**`Disable/Delete User After End Date`**を検索します。ジョブ詳細ページを開き、**「今すぐ実行」**ボタンをクリックしてジョブを実行します。
    
    **ノート**: デフォルトでは、このジョブは毎日実行されるようにスケジュールされています。
    
5.  ジョブが完了したら、セルフ・サービス・コンソールの前のブラウザ・タブに戻り、「ユーザー詳細」ページで**「リフレッシュ」**ボタンをクリックし、ユーザー・ログイン**RMAINOR**の**「ステータス」**属性に**「無効」**と表示されるようになります。
    
6.  「User Details」ページを閉じて「Users」ページに戻り、すべてのユーザーを一覧表示した場合、ユーザーログイン **RMAINOR**は削除され、そのログインはもうユーザーとして一覧表示されなくなるはずです。
    
7.  セルフ・サービス・コンソールからサインアウトします。これにより、管理コンソールのセッションもクローズされます。
    

## タスク5: 通知および新規資格証明のチェック(オプション)

1.  オプションで、**Oracle123**をパスワードとして使用して、電子メールWebクライアント**Roundcube**に従業員**DCOBY**としてログインします。
    
    例Roundcube Email Clientにログインします。
    
        URL         http://secureoracle.oracledemo.com/roundcubemail-1.4.1/
        User        DCOBY
        Password    Oracle123
        Server      secureoracle.oracledemo.com
        
2.  メール受信ボックスを確認します。従業員は、新しい資格証明(UserID)およびパスワードをリセットするためのリンクを含む、少なくとも1つの通知を受信している必要があります。
    
3.  **「Click here to reset password」**リンクをクリックしてOIMパスワード管理ページを開きます。
    
    **ノート**: 電子メール通知のパスワードをリセットするリンクは1日のみ有効であることに注意してください。
    
4.  新しいパスワードを入力し、チャレンジ質問に回答します。新しいパスワードとして**Oracle123**と入力します。
    
5.  **「発行」**ボタンをクリックします。次に、セルフ・サービス・コンソールにリダイレクトされます。しばらくしてから、**「自分の情報」**タイルでユーザーの詳細を確認します。
    
6.  セルフ・サービス・コンソールからサインアウトします。
    

## タスク6: 従業員の異動およびロールの更新

1.  ユーザー**hradmin**としてパスワード**Oracle123**でMy HRアプリケーションにログインします。
    
2.  **「従業員」**タイルをクリックして従業員ページを開き、1人の従業員(**DCOBY**など)を選択し、**鉛筆**アイコンをクリックして従業員の詳細を編集します。
    
    ![自分のHRアプリケーション](./images/img-myhr-app.png " ")
    
    図2.従業員の詳細の編集
    
3.  部門を**「営業」**から**「財務」**に変更し、**「変更の適用」**をクリックします。
    
4.  **xelsysadm**としてパスワード**Oracle123**でOIM管理コンソールにログインします。**「スケジューラ」**オプションをクリックし、**「システム管理」**タブで**`HRData*`**を検索します。
    
5.  結果リストから、ジョブ**HRData DBAT Trusted Resource User Reconciliation**を選択します
    
6.  「ジョブの詳細」タブで、**「今すぐ実行」**をクリックし、**「リフレッシュ」**をクリックして、「ジョブ履歴」の下にある下部を確認することで進捗をモニターします。
    
7.  ジョブのステータスが**Stopped::Success**で完了したら、スケジューラ・ウィンドウを閉じて管理コンソールからサインアウトします。
    

## タスク7: 部門異動およびロール更新の確認

1.  ユーザー**xelsysadm**でパスワード**Oracle123**を使用してOIMセルフ・サービス・コンソールにログインします。**`Manage -> Users`**をクリックし、ユーザー・ログイン**DCOBY**をクリックします。
    
2.  ユーザー詳細ページで、**「属性」**タブをクリックし、組織名がSalesからFinanceに変更されているかどうかを確認します。
    
3.  「自分のHRアプリケーション」は信頼できるソースであるため、組織/部門の変更に関する承認は必要ありません。
    
4.  **「ロール」**タブをクリックし、従業員に**財務ロール**が割り当てられていることを確認します。
    
5.  セルフ・サービス・コンソールからサインアウトします。
    

## タスク8: セルフ・サービス、アクセス・リクエストおよび承認

1.  電子メールWebクライアント**Roundcube**に、パスワード**Oracle123**を使用して従業員**RLAURIA**としてログインし、OIMユーザー資格証明(UserID)を取得し、パスワードおよびチャレンジ質問を設定するリンクを取得します。
    
2.  前のステップが完了したら、OIMセルフ・サービス・コンソールにログインします。**`Request Access -> Request for Self`**をクリックします。
    
3.  リクエスト・ページで、**「カタログ」**タブを選択し、次に**「アプリケーション」**ラジオ・ボタンをクリックします。
    
4.  検索ボックスに「**My**」と入力し、「**Search**」をクリックします。
    
5.  結果リストから**「My OUD Directory」**を選択し、**「Add to Cart」**ボタンをクリックします。
    
6.  ページの上部にある**「次へ」**ボタンをクリックします。
    
7.  **「カート・アイテム」**セクションを展開し、アイテム**「My OUD Directory」**を選択し、「リクエスト詳細」の下の**鉛筆**アイコンをクリックします。
    
8.  アプリケーションの詳細を適切に入力します。
    
    例ユーザー **RLAURIA**の次のデータを入力します
    
        	ATTRIBUTE       VALUE
        	Container DN    OUDDirectory~iam
        
    
    **ノート**: コンテナDNは、OAMがユーザー・アカウントの格納に使用するOUDディレクトリ内の場所に対応します。つまり、このアカウントをプロビジョニングすることで、ユーザーはOAMで有効なアカウントを持つことになります。**「ユーザーID」**、**「パスワード」**、**「名」**、**「姓」**、**「Eメール」**、**「共通名」**などの残りの属性は、プロビジョニング操作中にOIMによって自動移入されます。
    
9.  **「更新」**ボタンをクリックし、ページ上部の**「送信」**ボタンをクリックしてアクセス・リクエストを送信します。
    
10.  **「セルフサービス」**タブに戻り、**「要求の追跡」**タイルをクリックします。リクエストの追跡ページの**「検索」**フィールドで、**「ステータス」**を選択し、2番目のボックスで**「承認待ちのリクエスト」**を選択し、**虫めがね**アイコンをクリックします。
    
11.  ユーザーによって発行された要求がリストされ、**「要求ID」**リンクをクリックして詳細を表示します。
    
12.  要求詳細ページで、**「承認詳細」**タブをクリックして、**「タスク・ステータス」**および**「割当先」**をレビューします。割当先は、RLAURIAのマネージャ**JSMITH**である必要があります。
    
13.  ページを閉じ、セルフサービス・コンソールからサインアウトします。
    

## タスク9: 処理可能な通知を使用した要求の承認

1.  **Oracle123**をパスワードとして使用して、マネージャ**JSMITH**として電子メールWebクライアント**Roundcube**にログインします。
    
    例: Roundcube Email Clientにログインします。
    
        	URL         http://secureoracle.oracledemo.com/roundcubemail-1.4.1/
        	User        JSMITH
        	Password    Oracle123
        	Server      secureoracle.oracledemo.com
        
2.  メール受信ボックスを確認します。マネージャーは、従業員 **RLAURIA**によって送信されたアクセス リクエストの承認を求める通知を受信している必要があります。
    
3.  Eメールを開き、依頼者が**Ray Lauria**であるかどうかを確認し、**「承認」**リンクをクリックします。
    
    ![承認用のラウンドキューブ通知メール](./images/uc03-action-notification.png " ")
    
    図3.処理可能通知- 承認
    
4.  返信通知で、**「コメント」**セクション(**「リクエスト承認」**など)にカッコ間のノートを入力し、**「送信」**ボタンをクリックして電子メールを送信します。
    
5.  宛先アドレスが**`SOA@oracledemo.com`**であることに注意してください。これは、通知がSOAサーバーによってアクション可能な通知として処理され、OIMにリレーされてリクエストが更新されることを示します。
    
6.  電子メールWebクライアントからログアウトします。
    

## タスク10: 要求されたアプリケーション・アクセスの確認

1.  ユーザー**RLAURIA**としてOIMセルフ・サービス・コンソールにログインします。**「マイ・アクセス」**タイルをクリックします。
    
2.  アクセス・ページで、**「アカウント」**タブをクリックし、アプリケーションの**「My OUD Directory」**がリストされているかどうかを確認します。
    
3.  **「My OUD Directory」**行を選択し、**「Detail Information」**タブで詳細を確認します。
    
4.  セルフサービス・コンソールからサインアウトします。
    
    ![OIMセルフサービス](./images/uc03-account-provisioned.png " ")
    
    図4.プロビジョニングされたアカウント- アクセス・リクエスト
    

## タスク11: ターゲット・アプリケーションのアカウントの確認(オプション)

1.  このステップはオプションであり、プロビジョニングされたアカウントをテストするためにOAMサーバーを実行する必要があります。OIMコンポーネントをすでに起動しているため、OIMに加えてOAMサーバー・コンポーネントを起動できるようにするには、環境に少なくとも48 GBの合計メモリーが必要です。
    
    たとえば、**oracle**ユーザーとしてログインし、次のコマンドを実行してOAMを起動します。
    
        <copy>sc start oam</copy>
        
    
    **ノート**: OAMコンポーネントを起動する時間は、10分から15分によって異なります
    
2.  OAMが起動したら、ユーザー**RLAURIA**の資格証明を入力してOAMコンソールにログインします。
    
    たとえば、Oracle Access Manager管理コンソールにログインします。
    
        	URL         http://secureoracle.oracledemo.com:8001/oamconsole
        	User        RLAURIA
        	Password    Oracle123
        
    
    **ノート**: アクセス・リクエストのプロビジョニング時と同じパスワードを使用しています。OIMはこの値をOIMユーザー・プロファイルから新しいアカウントにコピーしました。
    
3.  アカウント資格証明が正しい場合は、空のOAMページが表示される必要があります。これは、ユーザー・アカウントにコンソールに対する管理権限がないためです。
    
4.  OAMコンソールからサインアウトします。
    

## タスク12: 従業員退職

1.  ユーザー**hradmin**としてパスワード**Oracle123**でMy HRアプリケーションにログインします。
    
2.  **「従業員」**タイルをクリックして従業員ページを開き、1人の従業員(**Denny Coby**など)を選択し、**鉛筆**アイコンをクリックして従業員の詳細を編集します。
    
3.  **「削除」**ボタンをクリックしてユーザーの削除を続行し、**「OK」**をクリックして削除を確定します。
    
4.  パスワード**Oracle123**でユーザー**xelsysadm**としてOIM管理コンソールにログインします。**「スケジューラ」**オプションをクリックし、「システム管理」タブで**`HRData*`**を検索します。
    
5.  結果リストから、ジョブ**HRData DBAT Trusted Resource User Delete Reconciliation**を選択します。
    
6.  「ジョブの詳細」タブで、**「今すぐ実行」**をクリックし、**「リフレッシュ」**をクリックして、「ジョブ履歴」の下にある下部を確認することで進捗をモニターします。
    
7.  ジョブがジョブ・ステータス**`Stopped::Success`**で完了したら、上部の「イベント管理」タブをクリックし、**矢印**アイコンをクリックしてリコンシリエーション・イベントを検索します。
    
8.  プロファイル名が**HRData**のイベントのリストは、レコードが処理されたことを示す最新のイベントとしてリストする必要があります。最後のイベントIDをクリックして詳細を表示します。イベントの現在のステータスが**「削除成功」**と表示されている場合、従業員は正常に削除されました。管理コンソールからサインアウトします。
    

## タスク13: 退職した従業員の確認

1.  ユーザー**xelsysadm**でパスワード**Oracle123**を使用してOIMセルフ・サービス・コンソールにログインします。**`Manage -> Users`**をクリックして、退職した従業員がユーザー・ページにユーザーとしてリストされていないかどうかを確認します。
    
2.  セルフ・サービス・コンソールからサインアウトします。
    

## **付録**: 承認ワークフローについて

1.  OIMリクエストの生成と承認は、ワークフロー・ルールの使用と構成によって異なります。ワークフロー・ルールによって、次のことが決定されます。
    
    *   操作の承認が必要かどうか
    *   特定の操作に対してどのワークフローを起動する必要があるか
2.  **`UC03. Self Service, Access Request and Approvals`**でマネージャの承認を示すために、OIMの**「プロビジョニングApplicationInstance」**操作にワークフロールールを追加しました。
    
    たとえば、次のルールが追加され、デフォルト・ルールの前に評価されるように最初に設定されています。
    
        	RULE NAME   Provision Account Organization Rule
        	CONDITION   IF user.Organization Name Equal Sales OR user.Organization Name Equal Finance
        	            THEN workflow Equal default/RequesterManagerApproval!3.0
        
3.  ワークフロールールの評価時には、次のことを考慮する必要があります。
    
    *   実行対象の操作に関連付けられた承認ワークフロールールが設定時の順序で評価されます。
    *   承認ワークフロー評価は最初に一致したルール(trueに評価されたルール)で停止し、そのルールの結果が結果として戻されます。
    *   すべての非バルク操作で、一致するルールがない場合、**SOAConfig**の**defaultOperationApprovalComposite**で構成されたSOAコンポジットは暗黙的に返されます。これにより、通常、承認リクエストが`SYSTEM ADMINISTRATOR`に送信されます。
4.  ワークフロー・ルールは、デプロイメント・マネージャを使用してソース環境(テスト環境など)からエクスポートしてターゲット環境(本番環境など)にインポートできます。
    
5.  OIMシステム定義の操作およびルールの詳細は、次の[リンク](https://docs.oracle.com/en/middleware/idm/identity-governance/12.2.1.3/omadm/managing-workflows.html#GUID-F21C1DC9-49A3-48F1-820C-2422CB24678A)を参照してください。
    

_次の演習に進む_ことができます。

## さらに学ぶ

Oracle Identity and Access Managementの詳細は、次のリンクを参照してください。

*   [Oracle Identity Management Webサイト](https://docs.oracle.com/en/middleware/idm/suite/12.2.1.4/index.html)
*   [Oracle Identity Governanceのドキュメント](https://docs.oracle.com/en/middleware/idm/identity-governance/12.2.1.4/index.html)
*   [Oracle Access Managementドキュメント](https://docs.oracle.com/en/middleware/idm/access-manager/12.2.1.4/books.html)

## 謝辞

*   **著者** - Ricardo Gutierrez氏、ソリューション・エンジニアリング- セキュリティおよび管理
*   **貢献者** - Rene Fontcha
*   **最終更新者/日付** - Sahaana Manavalan氏、LiveLabs開発者、NA Technology、2022年3月