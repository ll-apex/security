# 機密データのマスク

## 概要

データ・マスキングは、本番以外の目的にデータが安全であるように機密データをマスクする方法です。たとえば、開発およびテスト・アクティビティをサポートするために、組織では多くの場合、本番データのコピーを作成する必要があります。本番データをコピーするだけで、機密データが新しいユーザーに公開されます。セキュリティ・リスクを回避するには、データ・マスキングを使用して、機密データを現実的だが架空のデータに置き換えます。

データ・マスキング機能によって生成されたデフォルトのマスキング・ポリシーを使用して、[Discover機密データ](?lab=discover-sensitive-data)・ラボで検出した機密データをマスクします。データベース・アクションを使用して、マスクされたデータに対する前後の影響を表示します。

推定ラボ時間: 15分

### 目標

この演習では、次のことを行います。

*   ターゲット・データベースに対するデータ・マスキング・ロールの付与
*   ターゲット・データベースの機密データの表示
*   ターゲット・データベースのマスキング・ポリシーの作成
*   データ・マスキングを使用して、ターゲット・データベースの機密データをマスクします
*   データ・マスキング・レポートの表示
*   データ・マスキング・レポートのPDFの作成
*   ターゲット・データベースのマスクされたデータの検証

### 前提条件

この演習では、次を想定しています。

*   Oracle Cloudアカウントを取得し、Oracle Cloud Infrastructure Consoleにサインインします。
*   このワークショップのための環境の準備([環境の準備](?lab=prepare-environment)を参照)
*   ターゲット・データベースをOracle Data Safeに登録しました。手元にあるデータベースの`ADMIN`パスワードが必要です([Autonomous DatabaseのOracle Data Safeへの登録](?lab=register-autonomous-database)を参照)。
*   機密データ・モデルの作成([Discover Sensitive Data](?lab=discover-sensitive-data)を参照)

### 前提条件

*   実際のデータ値は、スクリーンショットに表示されている値と異なる場合があります。

## タスク1: ターゲット・データベースに対するデータ・マスキング・ロールの付与

**Autonomous Databaseサーバーレス(すべての場所からのセキュア・アクセスを使用)**でデータ・マスキング機能を使用するには、最初にデータ・マスキング・ロールをデータベースのOracle Data Safe事前シード済サービス・アカウントに付与する必要があります。別の種類のターゲット・データベースを使用している場合は、_Oracle Data Safeの管理_ガイドを参照して、必要なロールの付与方法を確認してください。

1.  データベース・アクションのSQLワークシートにアクセスします。セッションが期限切れになった場合は、`ADMIN`ユーザーとして再度サインインします。ワークシートおよび**「スクリプト出力」**タブをクリアします。
    
2.  SQLワークシートで、次のコマンドを入力して、ターゲット・データベースのOracle Data Safeサービス・アカウントにデータ・マスキング・ロールを付与します。
    
        <copy>EXECUTE DS_TARGET_UTIL.GRANT_ROLE('DS$DATA_MASKING_ROLE');</copy>
        
3.  ツールバーで、**「文の実行」**ボタン(白い矢印付きの緑色の円)をクリックして問合せを実行します。
    
    ![ツールバーの「文の実行」ボタン](images/run-statement-button.png "ツールバーの「文の実行」ボタン")
    
4.  スクリプト出力が次のように表示されることを確認します。
    
    `PL/SQL procedure successfully completed`
    
    これで、ターゲット・データベースの機密データをマスクできます。
    
5.  ワークシートおよびスクリプトの出力をクリアします。
    

## タスク2: ターゲット・データベースの機密データの表示

[「Discover Sensitive Data」](?lab=discover-sensitive-data)ラボでは、`HCM1.EMPLOYEES`表に機密データがあることを学習しました。このタスクでは、その表の実際の機密データを表示します。

1.  **「ナビゲータ」**タブで、最初のドロップダウン・リストから**HCM1**スキーマを選択します。
    
2.  `EMPLOYEES`表をワークシートにドラッグします。
    
    ![従業員表](images/drag-employees-table-to-worksheet.png "従業員表")
    
3.  挿入タイプの選択を求められたら、**「選択」**をクリックし、**「適用」**をクリックします。
    
    ![「挿入」ダイアログ・ボックスのタイプを選択します](images/insertion-type-select.png "「挿入」ダイアログ・ボックスのタイプを選択します")
    
4.  ワークシートでSQL問合せを表示します。
    
    ![EMPLOYEES表が表示された「ワークシート」タブ](images/query-employees-table.png "EMPLOYEES表が表示された「ワークシート」タブ")
    
5.  ツールバーで、**「スクリプトの実行」**ボタンをクリックします。
    
    ![「スクリプトの実行」ボタン](images/run-script.png "「スクリプトの実行」ボタン")
    
6.  **「スクリプト出力」**タブで、問合せ結果を確認します。
    
    *   `EMPLOYEE_ID`、`FIRST_NAME`、`LAST_NAME`、`EMAIL`、`PHONE_NUMBER`、`HIRE_DATE`などのデータは機密データとみなされ、非本番で使用するために共有する場合はマスクする必要があります。
7.  Oracle Data Safeのブラウザ・タブに戻ります。後で戻るため、このブラウザ・タブは開いたままにします。
    

## タスク3: ターゲット・データベースのマスキング・ポリシーの作成

データ・マスキングでは、機密データ・モデルに基づいてターゲット・データベースのマスキング・ポリシーを生成できます。機密列ごとにデフォルトのマスキング・フォーマットが自動的に選択されます。これらのデフォルトの選択内容を編集し、必要に応じて別の選択内容を選択できます。場合によっては、問題(存在する場合)をマスキング・フォーマットで修正するように求められることがあります。

1.  ページ上部のブレッドクラムで、**「データ・セーフ」**をクリックします。
    
2.  左側の**「セキュリティ・センター」**で、**「データ・マスキング」**をクリックします。
    
3.  **「関連リソース」**で、**「マスキング・ポリシー」**をクリックします。
    
4.  左側の**「リスト範囲」**で、コンパートメントを選択します。**「マスキング・ポリシー」**ページには、ターゲット・データベースに使用可能なマスキング・ポリシーがないことが表示されます。
    
    ![「Masking Policies」ページ](images/no-masking-policies-available.png "「Masking Policies」ページ")
    
5.  **「マスキング・ポリシーの作成」**をクリックします。
    
    **「マスキング・ポリシーの作成」**パネルが表示されます。
    
6.  マスキング・ポリシーを次のように構成します。
    
    *   名前: **Mask SDM1**
    *   コンパートメント: **コンパートメントの選択**
    *   説明: **SDM1のマスキング・ポリシー**
    *   マスキング・ポリシーの作成方法を選択します。**「機密データ・モデルの使用」**は選択したままにします。
    *   機密データ・モデル: **SDM1\[your-target-database-name\]**を選択します。この機密データ・モデルがない場合は、[Discover機密データ](?lab=discover-sensitive-data)・ラボを参照してください。
    
    ![SDM1を使用した「マスキング・ポリシーの作成」パネル](images/create-masking-policy-sdm1.png "SDM1を使用した「マスキング・ポリシーの作成」パネル")
    
7.  **「マスキング・ポリシーの作成」**をクリックします。
    
    _重要!パネルを閉じないでください。すべての操作が完了すると、自動的に閉じます。操作が終了する前にパネルを閉じると、マスキング・ポリシーに列を追加する操作は開始されません。_
    
    **「マスキング・ポリシーの詳細」**ページが表示されます。
    
8.  マスキング・ポリシーを確認します。
    
    *   **「マスキング・ポリシー情報」**タブでは、マスキング・ポリシー名(および編集)、マスキング・ポリシーのOracle Cloud Identifier (OCID)、マスキング・ポリシーが格納されているコンパートメント、へのリンクを表示できますマスキング・ポリシーの作業リクエスト、マスキング・オプションへのリンク、マスキング・ポリシーが関連付けられているターゲット・データベースおよび機密データ・モデル、およびマスキング・ポリシーが作成されて最後に更新された日時。
    *   **「マスキング列」**表には、すべてのマスキング列とそのマスキング・フォーマットがリストされます。必要に応じて、任意のマスキング列に対して別のマスキング・フォーマットを選択できます。マスキング・フォーマットの横にある鉛筆アイコンをクリックして編集できます。
    
    ![マスクのマスキング・ポリシー詳細ページ SDM1 - top](images/masking-policy-details-page-mask-sdm1-top.png "マスクのマスキング・ポリシー詳細ページ SDM1 - top") ![マスクのマスキング・ポリシー詳細ページ SDM1 - 下](images/masking-policy-details-page-mask-sdm1-bottom.png "マスクのマスキング・ポリシー詳細ページ SDM1 - 下")
    
9.  左側の**「リソース」**で、**「注意が必要なマスキング列」**をクリックします。
    
    ページの下部に**「注意が必要なマスキング列」**セクションが表示されます。この項では、適切に構成されたマスキング・フォーマットがないマスキング列について説明します。次のスクリーンショットは、注意が必要なマスキング列がない例を示しています。
    
    ![「注意が必要」セクションのマスキング列](images/masking-columns-needing-attention.png "「注意が必要」セクションのマスキング列")
    

## タスク4: データ・マスキングを使用したターゲット・データベースの機密データのマスク

マスキング・ポリシーの作成後、**「マスキング・ポリシーの詳細」**ページからターゲット・データベースに対してデータ・マスキング・ジョブを実行できます。**「データ・マスク」**ページからデータ・マスキング・ジョブを実行することもできます。

1.  **「マスキング・ポリシーの詳細」**ページで、**「ターゲットのマスク」**をクリックします。
    
    **「機密データのマスク」**パネルが表示されます。
    
2.  **「ターゲット・データベース」**ドロップダウン・リストからターゲット・データベースを選択し、**「データのマスク」**をクリックします。
    
    ![「機密データのマスク」パネル](images/mask-sensitive-data-panel.png "「機密データのマスク」パネル")
    
    **「作業リクエスト」**ページが表示されます。
    
3.  **「ログ・メッセージ」**表にログ・メッセージを表示して、作業リクエストの進行状況をモニターします。
    
    ![データ・マスキング作業リクエストのログ・メッセージ](images/masking-log-messages.png "データ・マスキング作業リクエストのログ・メッセージ")
    
4.  ステータスが **SUCCEEDED**と表示されるのを待ちます。
    
    ![マスキング・ジョブの「作業リクエスト」ページが成功しました](images/work-request-masking-job-succeeded.png "マスキング・ジョブの「作業リクエスト」ページが成功しました")
    

## タスク5: データ・マスキング・レポートの表示

1.  **「作業リクエスト」**ページで、**「作業リクエスト情報」**タブの**「マスキング・レポート」**の横にある**「詳細の表示」**をクリックします。
    
    **「マスキング・レポートの詳細」**ページが表示されます。
    
2.  マスキング・レポートを確認します。
    
    *   **「マスキング・レポート情報」**タブには、ターゲット・データベース名、マスキング・ポリシー名(リンクをクリックして表示できます)、マスキング・レポートのOracle Cloud Identifier (OCID)、データ・マスキング・ジョブが開始および終了した日時、およびマスクされた機密タイプ、スキーマ、表、列および値の数が表示されます。リンクをクリックすると、マスキング・オプションを表示できます。また、機密タイプごとにマスクされた値の割合を示す円グラフもあります。円のスライスをクリックすると、チャートにドリルダウンできます。
    *   **「マスクされた列」**表には、各マスクされた機密列と、それぞれのスキーマ、表、マスキング・フォーマット、機密タイプ、親列、およびマスクされた値の合計数がリストされます。
    
    ![マスキング・レポート・トップ](images/masking-report-top2.png "マスキング・レポート・トップ") ![マスキング・レポート下部](images/masking-report-bottom.png "マスキング・レポート下部")
    

## タスク6: データ・マスキング・レポートのPDFの作成

1.  **「マスキング・レポートの詳細」**ページの上部で、**「レポートの生成」**をクリックします。
    
    **レポートの生成**ダイアログ・ボックスが表示されます。
    
2.  **「PDF」**を選択したままにして、**「レポートの生成」**をクリックします。レポートが生成されるまで待ってから、**ここ**のリンクをクリックしてレポートをダウンロードします。
    
    ![マスクされたデータのPDFレポートの生成](images/generate-pdf-masked-data.png "マスクされたデータのPDFレポートの生成")
    
3.  PDFレポートを開き、レビューしてからクローズします。
    
    ![データ・マスキングPDFレポート](images/data-masking-pdf-report.png "データ・マスキングPDFレポート")
    

## タスク7: ターゲット・データベースのマスクされたデータの検証

1.  データベース・アクションのSQLワークシートに戻ります。セッションが期限切れになった場合は、`ADMIN`ユーザーとして再度サインインします。`EMPLOYEES`表に対する`SELECT`文がワークシートに表示されます。**「スクリプト出力」**タブには、元のデータが引き続き表示されます。ちょっと見てみてください。
    
2.  ツールバーで、**「文の実行」**ボタン(**「スクリプトの実行」**ボタンではなく)をクリックして問合せを実行します。
    
3.  ページ下部の**「問合せ結果」**タブでマスクされたデータを確認します。パネルのサイズを変更して、さらにデータを表示したり、下にスクロールしたり、右にスクロールしたりできます。
    
    ![マスクされたEMPLOYEEデータ](images/masked-query-results.png "マスクされたEMPLOYEEデータ")
    
4.  マスクされたデータを元のデータと比較するには、**「スクリプト出力」**タブをクリックします。このタブには元のデータが引き続き含まれます。
    

## さらに学ぶ

*   [データ・マスキング](https://docs.oracle.com/en-us/iaas/data-safe/doc/data-masking.html)

## 確認

*   **著者** - データベース開発、コンサルティング・ユーザー・アシスタンス開発者、Jody Glover
*   **最終更新者/日付** - Jody Glover、2023年6月8日