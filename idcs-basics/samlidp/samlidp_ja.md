# フェデレーションの構成- 外部アイデンティティ・プロバイダ(Okta)

## 概要

_アイデンティティ・プロバイダ_(_アイデンティティ・アサーション・プロバイダ_)は、Oracle Identity Cloud Serviceの外部にあるWebサイトを使用してOracle Identity Cloud Serviceと相互作用するユーザーの識別子を提供します。_サービス・プロバイダ_は、アプリケーションをホストするOracle Identity Cloud ServiceなどのWebサイトです。アイデンティティ・プロバイダを有効にし、1つ以上のサービス・プロバイダを定義できます。ユーザーは、アイデンティティ・プロバイダから直接、サービス・プロバイダによってホストされるアプリケーションにアクセスできます。

この演習では、WebサイトでユーザーがOkta資格証明を使用してOracle Identity Cloud Serviceにログインできます。Oktaがアイデンティティ・プロバイダとして機能し、Oracle Identity Cloud Serviceがサービス・プロバイダとして機能します。Oktaは、ユーザーが認可されたユーザーであることを確認し、情報をOracle Identity Cloud Serviceに返します。

推定ラボ時間: 30分

### 目標

この演習では、次のことを行います。

*   Oktaでのフェデレーションの構成
*   IDCSでのフェデレーションの構成
*   IdPにログインします。

### 前提条件

*   Oracle Free Tierまたは有料アカウント
*   Googleアカウント
*   Oktaインテグレータ・アカウント

## タスク1: Oktaの構成

*   _ペルソナ_:
    *   管理者

1.  1.  Oktaに移動して、[開発者アカウント](https://www.okta.com/integrate/signup/)にサインアップします。この部については、前提条件の項で説明しました。
2.  トライアル・アカウント資格証明を取得したら、トライアルをリクエストした後に受信したURL (カスタム資格証明(https://oracleworkshop.oktareview.comなど)を使用してログインし、_「アプリケーション」_に移動します。左上のメニューで、_「クラシックUI」_を選択します。 ![イメージ](images/L4001.png)
    
3.  上部のタブで、_「アプリケーション」_、_「アプリケーション」_の順に選択します。 ![イメージ](images/L4002.png)
    
4.  _「アプリケーションの追加」_ボタンを選択します。 ![イメージ](images/L4003.png)
    
5.  _「Create New App」_ボタンを選択します。 ![イメージ](images/L4004.png)
    
6.  _「SAML2.0」_を選択し、_「作成」_をクリックします。 ![イメージ](images/L4005.png)
    
7.  アプリケーション名(**IDCS\_SP**など)を入力し、_「次へ」_をクリックします。 ![イメージ](images/L4006.png)
    
8.  _「SAMLの構成」_セクションでは、IDCSメタデータから値を入力する必要があります
    
        https://<your tenant>.identity.oraclecloud.com/fed/v1/metadata
        
9.  OktaのSAML設定のメタデータから次の値を入力します。
    
    *   IDCSメタデータで、下部にある_AssertionConsumerService_を検索します。次に示すように、強調表示されたURLを_「場所」_にコピーします。OktaでURLを_シングル・サインオンURL_として入力します ![イメージ](images/L4007.png)
    *   IDCSメタデータで、上部にある_entityID_を検索します。次に示すように、強調表示されたURLをコピーします。OktaでURLを_「オーディエンスURI (SPエンティティID)」_として入力します。 ![イメージ](images/L4008.png)
    *   完了すると、Oktaの一般的な設定は次の例のようになります。残りのフィールドはデフォルト値のままにします。 ![イメージ](images/L4009.png)
10.  ページの最後までスクロールし、_「次へ」_をクリックします。 ![イメージ](images/L4010.png)
    
11.  必要なフィードバックを入力し、_「終了」_を選択します。 ![イメージ](images/L4011.png)
    
12.  IDPメタデータ・ファイルをエクスポートするには、_「設定」_の下の_「アイデンティティ・プロバイダ・メタデータ」_をクリックします。 ![イメージ](images/L4012.png)
    
13.  メタデータは別のブラウザ・ウィンドウに表示されます。IDCS内で数分で必要になるため、右クリックして「名前を付けて保存」を選択してxmlファイルに保存します。 ![イメージ](images/L4013.png)
    
14.  _「Okta」_に戻り、新しく作成したアプリケーションの_「割当て」_タブを選択して、ユーザーをアプリケーションに割り当てます。 ![イメージ](images/L4014.png)
    
15.  _「割当て」_をクリックし、_「ユーザーに割当て」_を選択します。 ![イメージ](images/L4015.png)
    
16.  リストでユーザーを選択し、_「割当て」_を選択します。対応するIDCSユーザーのユーザー名を入力し、_「保存して戻る」_を選択します。ユーザーが割り当てられたら、_「完了」_をクリックします。
    
    ![イメージ](images/L4016.png)
    
    ノート: これは、Oktaへのログイン時に指定するユーザー名ではありません。これは変わりません。ここで入力するのは、IDCSの対応するユーザーのユーザー名です。これにより、IDCSとOktaで異なるユーザー名を持つアカウント間のリンクが可能になります。アカウントのユーザー名が異なる場合があります。たとえば、Oktaでは、IDCSでは必須ではありませんが、電子メール形式では必須であるためです。
    
17.  IDCSは、Oktaでサービス・プロバイダとして構成されるようになりました。IDCSを開き、Oktaをアイデンティティ・プロバイダとして構成します。
    

## タスク2: IDCSの構成

*   _ペルソナ_:
    *   管理者

1.  IDCS管理コンソールにログインし、_「セキュリティ」_に移動して_「アイデンティティ・プロバイダ」_をクリックします。_「SAML IDPの追加」_をクリックします。プロバイダの名前(「Okta-<\>」など)と説明を入力し、「次」をクリックします。 ![イメージ](images/L4017.png) 
    
2.  以前にエクスポートされたOktaメタデータxmlファイルをアップロードし、_「次へ」_をクリックします。 ![イメージ](images/L4018.png)
    
3.  次のパラメータを設定します。
    
    *   アイデンティティ・プロバイダ・ユーザー属性= **Name ID**
    *   Oracle Identity Cloud Serviceユーザー属性= **ユーザー名**
    *   リクエストされたNameID形式= **未指定** ![イメージ](images/L4019.png)
4.  エクスポート画面では、URLからIDCSメタデータをすでに取得しており、再度ダウンロードする必要はありません。_「次へ」_をクリックします。 ![イメージ](images/L4020.png)
    
5.  IDCSとOkta間の接続を確認するには、_「ログインのテスト」_を選択します。 ![イメージ](images/L4021.png)
    
6.  Okta資格証明を入力します。 ![イメージ](images/L4022.png)
    
7.  すべてが機能する場合は、次に示すメッセージが表示されます。それ以外の場合は、OktaのIDCSアプリケーションまたはIDCSのOkta SAML IDP(あるいはその両方)の構成を確認してください。 ![イメージ](images/L4023.png)
    
8.  SAML IDP設定フローに戻り、_「次へ」_を選択します。 ![イメージ](images/L4024.png)
    
9.  _「アクティブ化」_、_「終了」_の順に選択します。これで、Oktaが外部アイデンティティ・プロバイダとして追加され、IDCSとの接続が正常に確立されました。 ![イメージ](images/L4025.png)
    
10.  Oktaアプリケーションの設定が正常に終了すると、_「アイデンティティ・プロバイダ」_画面に戻ります。_ログイン・ページに表示_するメニューを選択します。 ![イメージ](images/L4026.png)
    
11.  _「セキュリティ」_に移動し、_「IDPポリシー」_を選択して、_「デフォルトのアイデンティティ提供ポリシー」_をクリックします。 ![イメージ](images/L4027.png)
    
12.  _「+割当て」_メニュー・オプションを選択し、Oktaプロバイダを追加します。 ![イメージ](images/L4028.png)
    
13.  _「Okta」_を選択し、_「OK」_をクリックします。 ![イメージ](images/L4029.png)
    
14.  _Okta_がリスト![イメージ](images/L4030.png)に表示されます
    
15.  IDCSの_サインアウト_します。![イメージ](images/L4031.png)
    

## タスク3: 外部IDPログインの確認

*   _ペルソナ_:
    *   管理者

1.  IDCS管理コンソールにアクセスすると、Oktaがサインイン・オプションとして表示されます。_「Okta」_を選択します。 ![イメージ](images/L4032.png)
    
2.  Oktaログイン資格証明を入力します。 ![イメージ](images/L4033.png)
    
3.  正常に認証されると、リクエストはIDCSの「自分のアプリケーション」画面に送信されます。 ![イメージ](images/L4034.png)
    
    ノート: フェデレーションが機能するには、IDCSとOktaの両方で定義されているアカウントでログインする必要があります。
    

次の演習に進むことができます。

## 確認

*   **作成者** - SEHubセキュリティおよび管理チーム
*   **最終更新者/日付** - プリンシパル・ソリューション・エンジニア、Lucian Ionescu、15.09.2020