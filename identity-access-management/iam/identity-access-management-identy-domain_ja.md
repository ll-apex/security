# アイデンティティおよびアクセス管理

## 概要

Oracle Cloud Infrastructure (OCI) Identity and Access Management (IAM) Serviceでは、クラウド・リソースにアクセスできるユーザーを制御できます。ユーザー・グループのアクセスのタイプと、どの特定のリソースにアクセスするかを制御します。11月、アイデンティティ・ドメインを含めることで、OCI IAMとOracle IDCSは単一のクラウド・サービスに統合されました。

この演習の目的は、Identidyドメインを含むIAMサービス・コンポーネントと、これらがどのように動作するかを理解するのに役立つシナリオの例を示すことです。

推定時間: 30分

### 目標

この演習では、次のことを行います。

*   コンパートメントの作成
*   ユーザーの作成
*   グループの作成
*   グループに関連付けられたポリシーの作成
*   グループへのユーザーの追加

### 前提条件

*   Oracle Cloudアカウント- このワークショップのLiveLabsランディング・ページを参照して、サポートされている環境を確認してください。

> **ノート:** **無料トライアル**・アカウントがある場合、無料トライアルの期限が切れると、アカウントは**Always Free**アカウントに変換されます。Always Free環境が使用可能でないかぎり、Free Tierワークショップは実行できません。

**[Free TierのFAQページはここをクリックしてください。](https://www.oracle.com/cloud/free/faq.html)**

## タスク1: コンパートメントの作成

コンパートメントは、コンピュート・インスタンス、ロード・バランサ、データベースなどのクラウド・アセットの集合です。デフォルトでは、テナンシの作成時にルート・コンパートメントが作成されました(つまり、トライアル・アカウントに登録したとき)。ルート・コンパートメントにすべてを作成することは可能ですが、Oracleでは、リソースをより効率的に管理できるようにサブコンパートメントを作成することをお薦めします。

1.  左上の**「ナビゲーション・メニュー」**をクリックし、**「アイデンティティとセキュリティ」**に移動して**「コンパートメント」**を選択します。

![](https://oracle-livelabs.github.io/common/images/console/id-compartment.png " ")

1.  **コンパートメントの作成**をクリックします。 ![コンパートメントの作成](images/create-compartment.png)
    
2.  コンパートメントに**「デモ」**という名前を付け、簡単な説明を入力します。ルート・コンパートメントが親コンパートメントとして表示されていることを確認します。準備ができたら、青色の**「コンパートメントの作成」**ボタンを押します。
    
    ![コンパートメントの作成](images/compartment-details.png)
    
3.  このテスト・ドライブのすべての作業に対してコンパートメントを作成しました。
    

## タスク2: アクセスを制御するユーザー、グループおよびポリシーの管理

サービスにアクセスするためのユーザーの権限は、それらが属する_グループ_から取得されます。グループの権限はポリシーによって定義されます。ポリシーは、グループのメンバーが実行できるアクションおよびコンパートメントを定義します。ユーザーは、自分がメンバーであるグループに対して設定されたポリシーに基づいて、サービスにアクセスして操作を実行できます。

概念を理解するためのユーザー、グループおよびセキュリティ・ポリシーを作成します。

2022年、OCI IAMはアイデンティティ・ドメインを導入しました。アイデンティティ・ドメインは、ユーザーとロールの管理、ユーザーのフェデレーションとプロビジョニング、Oracle Single Sign-On (SSO)構成を介したセキュアなアプリケーション統合、およびOAuth管理を行うためのコンテナです。

1.  左上の**「ナビゲーション・メニュー」**をクリックします。**「アイデンティティとセキュリティ」**に移動し、**「ドメイン」**を選択します

アイデンティティ・ドメインを含むIAMの場合、IAMユーザーおよびグループとして以前に識別されたものは、デフォルト・ドメインの下にあります。

![](images/id-domains.png)

1.  デフォルト・ドメインの選択
    
    ![](images/id-domains-default.png)
    
2.  **「グループ」**を選択します
    
    ![](images/id-domains-groups.png)
    
3.  「**グループの作成**」をクリックします。
    
    **「グループの作成」**ダイアログ・ボックスで、次を入力します:
    
    *   **名前:** **oci-groupなど、グループの一意の名前を入力します**
        
        > **ノート:**グループ名に空白を含めることはできません。
        
    *   **説明:** **ociユーザーの新規グループなど、説明を入力します**
        
    *   **「作成」**をクリックします
        
    
    ![グループの作成](images/id-domains-create-group.png)
    
4.  新しいグループをクリックして表示します。新しいグループが表示されます。
    
    ![新規グループが表示されます](images/id-domains-group-detail.png)
    
5.  新規ユーザーの作成
    
    a)ブレッドクラムで、**「デフォルト・ドメイン」**をクリックします。
    
    ![ブレッドクラムでデフォルトドメインを選択](images/id-domains-bc-default-domain.png)
    
    左上にある**「ナビゲーション・メニュー」**をクリックし、**「アイデンティティとセキュリティ」**に移動して**「ドメイン」**を選択し、デフォルト・ドメインを選択して、**「ユーザー」**に移動することもできます
    
    b) **「ユーザー」**を選択します。
    
    ![ユーザーの選択](images/id-domains-users.png)
    
    c) **「ユーザーの作成」**をクリックします。
    
    **「ユーザーの作成」**ダイアログ・ボックスで、次を入力します:
    
    *   **Fisrt Name** - 名
    *   **姓 NameName** - 姓
    *   **電子メール:**テナンシですでに使用されている電子メールとは異なる、アクセス可能な個人電子メール・アドレス(GMail、Yahooなど)を使用することをお薦めします。
    *   **ユーザー名として電子メール・アドレスを使用:**電子メール以外のユーザー名を使用する場合は、チェックしたままにします。これは、テナンシですでに使用されているものと同じ電子メールを使用する場合に使用できます。
    *   **クラウド・アカウント管理者ロールの割当て:**選択を解除したままにします。
    *   **oci-group**の横にあるボックスを選択します
    
    **「作成」**をクリックします。
    
    ![新規ユーザー・フォーム](images/id-domains-create-user.png)
    
    ユーザーの作成後、ユーザー詳細が表示されます。
    
    新しく作成されたユーザーは、次のようなアクティブ化リンクを含む電子メールを受信します:
    
    ![アクティブ化電子メール](images/id-domains-activation-message.png)
    
6.  ユーザーが電子メールを受信しなかった場合、ユーザー詳細には、パスワード・リセット・リンクを送信するパスワードのリセット・ボタンがあります。
    
    ![パスワードのリセット](images/id-domains-user-resetpw.png)
    
    「リセット」ボタンをクリックすると、リセット・リンクを送信する前に確認を求められます。
    
7.  新しいユーザーに使用した電子メール・アカウントのメッセージを確認します。アクティブ化リンクを開きます(パスワードのリセットは同様の画面になります)
    
    ![パスワードのリセット](images/id-domains-resetpw.png)
    
8.  次に、割り当てられたコンパートメントでグループ権限を付与するセキュリティ・ポリシーを作成します。たとえば、コンパートメント**デモ**のグループ**oci-group**のメンバーに権限を付与するポリシーを作成します:
    
    a)左上の**「ナビゲーション・メニュー」**をクリックします。**「アイデンティティとセキュリティ」**に移動し、**「ポリシー」**を選択します。
    
    ![IAMポリシー](images/iam-policies.png)
    
    b)左側で、**「デモ」**コンパートメントを選択します。
    
    ![*デモ・コンパートメントの選択](images/id-domains-demo-compartment.png)
    
    > **ノート:**サブコンパートメント_**デモ**_を表示できるようにするには、メイン・コンパートメント名の横にある+記号をクリックする必要がある場合があります。サブコンパートメントがまだ表示されていない場合は、_**ブラウザをリフレッシュ**_します。ブラウザでコンパートメント情報がキャッシュされ、内部キャッシュが更新されない場合があります。
    
    c) **「デモ」**コンパートメントを選択した後、**「ポリシーの作成」**をクリックします。
    
    ![](images/id-domain-create-policy.png)
    
    d)ポリシーの一意の**名前**を入力します(例: "Policy-for-oci-group")。
    
    > **ノート:**名前にスペースを含めることはできません。
    
    e) **「説明」**を入力します(たとえば、「OCIグループのポリシー」)。
    
    f)コンパートメントの**「デモ」**を選択します。
    
    g) **「手動エディタの表示」**をクリックし、次の**「文」**を入力します。
    
        <copy>Allow group default/oci-group to manage all-resources in compartment Demo</copy>
        
    
    ノート: _group\_name_の前に_identity\_domain\_name_を含めないと、グループがデフォルト・アイデンティティ・ドメインに属しているかのようにポリシー・ステートメントが評価されます。
    
    h) **「作成」**をクリックします。
    
    ![作成](images/create-policy.png)
    
9.  ユーザー権限を確認します。
    
    a)左上の**「ナビゲーション・メニュー」**をクリックします。**「コンピュート」**をクリックし、**「インスタンス」**をクリックします。
    
    ![](https://oracle-livelabs.github.io/common/images/console/compute-instances.png " ")
    
    b)左側のメニューから任意のコンパートメントを選択してみます。
    
    c)「**You don't have permission to view these resources**」というメッセージが表示されます。ポリシーを関連付けたグループにユーザーを追加しなかったため、これは正常です。 ![エラー・メッセージは無視されます](images/no-permission.png)
    
    d)コンソールからサイン・アウトします。
    
10.  ユーザーをグループに追加します。
    
    a) _**admin**_アカウントで再度サインインします。
    
    b)左上の**「ナビゲーション・メニュー」**をクリックします。**「アイデンティティとセキュリティ」**に移動し、**「ユーザー」**を選択します。**「ユーザー」**リストから、作成したユーザー・アカウント(`User01`など)をクリックして、「ユーザーの詳細」ページに移動します。 ![](https://oracle-livelabs.github.io/common/images/console/id-users.png " ")
    
    c)左側の**「リソース」**メニューで、まだ選択されていない場合は**「グループ」**をクリックします。
    
    d) **「ユーザーをグループに追加」**をクリックします。 ![](images/image020.png)
    
    e) **「グループ」**ドロップダウン・リストから、作成した**oci-group**を選択します。
    
    f) **「追加」**をクリックします。 ![「追加」ボタンを押します](images/add-user-to-group.png)
    
    g) Oracle CloudのWebサイトからサインアウトします。
    
11.  ユーザーが特定のグループに属している場合は、ユーザーの権限を確認します。
    
    a)作成したローカルの **User01**アカウントでサインインします。このユーザーに割り当てた最新のパスワードを使用してください。
    
    b) **「ナビゲーション・メニュー」**をクリックします。**「コンピュート」**をクリックし、**「インスタンス」**をクリックします。
    
    c)左側のコンパートメントのリストからコンパートメント**「デモ」**を選択します。
    
    ![デモの選択](images/select-demo.png)
    
    d)権限に関連するメッセージがないため、新しいインスタンスを作成できます。
    
    e) **「ナビゲーション・メニュー」**をクリックします。**「アイデンティティとセキュリティ」**をクリックして**「グループ」**を選択します。
    
    f) **「Authorization failed or requested resource not found」**というメッセージが表示されます。ユーザーにはグループを変更する権限がないため、これが必要です。
    
    > **ノート:**かわりに、「予期しないエラーが発生しました」というメッセージが表示される場合があります。それも大丈夫です。
    
    ![](images/group-error.png)
    
    g)サインアウトします。
    

_おめでとうございます!演習を正常に完了しました。_

## 謝辞

*   **著者** - Orlando Gentil
*   **最終更新者/日付** - Orlando Gentil、2022年3月